var cuestionarios_view = Backbone.View.extend({
    el: 'body',
    defaults: {
        content_page: "#content_page"
    },
    events:{
        "click .btnGuardarCambiosCuestionario":"f_editarCuestionario",
        "click .btnGuardarCuestionario":"f_nuevoCuestionario",
        "click .btnDeleteCuestionario":"f_deleteCuestionario"

    },
    initialize: function(e){
        try {
            $("#tablaCuestionarios").DataTable();
        }catch(exception){
            console.log(exception);
        }
    },
    f_editarCuestionario:function(e){
        var _this = this;
        lo_current = e.currentTarget;

        var id_cuestionario = parseInt($(lo_current).data('hash'));
        console.log(id_cuestionario);

        la_data = {
            id_cuestionario:id_cuestionario,
            cuestionario:$(".txtCuestionario"+id_cuestionario).val(),
            descripcion:$(".txtDescripcion"+id_cuestionario).val(),
            intentos:$(".txtIntento"+id_cuestionario).val()
        }

        _this.model.f_editarCuestionario(la_data).done( function(response){
            if(response.ok){
                swal("Bien!","Cuestionario editado correctamente","success");
                location.href = BASE_URL+'catalogo-general/tipo-cuestionario';
            }else{
                swal("Upss!","No fue posible realizar los cambios","error");
            }
        });
    },
    f_nuevoCuestionario:function(e){
        var _this = this;
        la_data = {
            cliente:        $(".txtCliente").val(),
            cuestionario:   $(".txtCuestionario").val(),
            descripcion:    $(".txtDescripcion").val(),
            intentos:       $(".txtIntentos").val(),
            tipo:           $(".txtTipo").val()        
        }

        if( la_data.cuestionario != "" && la_data.descripcion != ""){
            _this.model.f_nuevoCuestionario(la_data).done( function(response){
                console.log(response);
                if(response.ok){
                    swal("Bien!","Nuevo cuastonario agregado correctamente","success");
                    location.href = BASE_URL+'catalogo-general/tipo-cuestionario';
                }else{
                    swal("Upss!","No fue posible, agregar un nuevo cuestionario","error");
                }
            });
        }else{
            $(".txtCuestionario").css({"border-left-width":"10px","border-left-color":"#ea6a6a"});
            $(".txtDescripcion").css({"border-left-width":"10px","border-left-color":"#ea6a6a"});
            swal("Upss!","Debes rellenar todos los campos","error");
        }

    },
    f_deleteCuestionario:function(e){
        var _this = this;
        lo_current = e.currentTarget;

        var id_cuestionario = parseInt($(lo_current).data('hash'));

        swal({   
            title: "Â¿Esta seguro?",   
            text: "Que desea, elimnar este cuestionario !!",   
            type: "warning",   
            showCancelButton: true,   
            confirmButtonColor: "#DD6B55",   
            confirmButtonText: "Confirmar",   
            closeOnConfirm: false 
        }, function(response){ 
            console.log(response);
            if(response){

                _this.model.f_eliminarCuestionario(id_cuestionario).done(function(res){
                });
                location.href = BASE_URL+'catalogo-general/tipo-cuestionario';

            }else{
                swal("Cancelado correctamente");
            }

        });
    }

});

$(document).ready(function () {
    cuestionarios_view = new cuestionarios_view({model: new cuestionario_model()});
    
});