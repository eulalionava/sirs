var catalogo_view = Backbone.View.extend({
    el: 'body',
    defaults: {
        content_page: "#content_page"
    },
    events:{
        "click .btnNuevaVacante":"f_nuevaVacante",
        "click .btnDeleteVacante": "f_deleteVacante",
        "click .btnAsignarVacante":"f_asignacionVacante",
        "click #btnFunciones":"f_funcionesVacantes",
        "click #btnRequisitos":"f_requisitosVacantes",
        "click #btnOfrecemos":"f_ofrecemosVacantes",
        "click .btnFinalizarVacante":"f_finalizarVacante",
        "click .btnGuardarCambiosVacante":"f_editarVacante",
        "change .txtCliente":"f_elegirCuestionarios",
        "click .asignandoCuestionario":"f_cuestionariosAsigna"

    },
    initialize: function(e){
        try {
            descripcion = "";
            funciones   = "Funciones: ";
            requisitos  = "Requisitos :";
            ofrecemos   = "Ofrecemos: ";
        }catch(exception){
            console.log(exception);
        }
    },
    f_deleteVacante:function(e){
        var _this = this;
        lo_current = e.currentTarget;

        var id_vacante = parseInt($(lo_current).data('hash'));

        swal({   
            title: "Â¿Esta seguro?",   
            text: "Que desea, elimnar esta vacante !!",   
            type: "warning",   
            showCancelButton: true,   
            confirmButtonColor: "#DD6B55",   
            confirmButtonText: "Confirmar",   
            closeOnConfirm: false 
        }, function(response){ 
            if(response) {
                _this.model.f_eliminarVacante(id_vacante).done( function(res){
                    if(res.ok){
                        location.href = BASE_URL+'catalogo-general/ver-vacantes';
                    }else{
                        swal("Upps!","No se pudo eliminar la vacante","error");
                    }
                });

            } else {
                swal("Cancelado correctamente");
            }

        });
    },
    f_asignacionVacante:function(e){
        var _this = this;
        lo_current = e.currentTarget;

        var id_vacante = parseInt($(lo_current).data('hash'));
        var vacante =$(lo_current).data('vac');
        la_data = {
            id_vacante:id_vacante,
            vacante:vacante
        }

        _this.model.f_asignar(la_data).done( function(response){
            $(_this.defaults.content_page).html(response.contenido);
        });

    },
    f_nuevaVacante:function(e){
        var _this = this;

        _this.model.f_getNuevaVacante().done( function(response){
            $(_this.defaults.content_page).html(response.contenido);
        });
    },
    f_funcionesVacantes:function(e){
        _funciones = $("#txtFunciones").val();
        if(_funciones != ""){
            funciones+='-'+_funciones+'. ';
            $(".contenidoF").html(funciones);
        }else{
            swal("Ups!","Necesitas escribir las funciones","warning");
        }

        $("#txtFunciones").val("");

    },
    f_requisitosVacantes:function(e){
        _requisitos = $("#txtRequisitos").val();
        if(_requisitos != ""){
            requisitos+='-'+_requisitos+'. ';
            $(".contenidoR").html(requisitos);
        }else{
            swal("Ups!","Necesitas escribir los requisitos","warning");
        }

        $("#txtRequisitos").val("");
    },
    f_ofrecemosVacantes:function(e){
        _ofrecemos = $("#txtOfrecemos").val();
        if(_ofrecemos != ""){
            ofrecemos+='-'+_ofrecemos+'. ';
            $(".contenidoO").html(ofrecemos);
        }else{
            swal("Ups!","No debes dejar el campo vacio","warning");
        }

        $("#txtOfrecemos").val("");

    },
    f_finalizarVacante:function(){
        var _this =  this;

        campana = $("#selCampania").val();
        lugar   = $("#txtLugar").val();
        vacante = $("#txtVacante").val();
        salario = $("#txtSalario").val();
        descripcion+= lugar.toUpperCase()+' Solicita: '+vacante+' '+funciones+' '+requisitos+' '+ofrecemos;
        
        la_data = {
            campana:   campana,
            vacante:    vacante,
            descripcion:descripcion,
            salario:    salario,
            estatus:    1
        }

        if(vacante != "" && salario != "" && descripcion !=""){

            _this.model.f_nuevaVacante(la_data).done( function(response){
                if(response.ok){
                    swal("Bien!","Se agrego una nueva vacante correctamente","success");
                    location.href = BASE_URL+'catalogo-general/ver-vacantes';
                }else{
                    swal("Ups!","No fue posible agregar la vacante","error");
                }
            });

        }else{
            swal("Upss","Debes rellenar todo que se te solicita","error");
        }
        console.log(la_data);
    },
    f_editarVacante:function(e){
        var _this = this;
        lo_current = e.currentTarget;

        var id_vacante = parseInt($(lo_current).data('hash'));
        la_data = {
            id_vacante  :id_vacante,
            vacante     :$(".editVacante"+id_vacante).val(),
            descrip     :$(".editDescripcion"+id_vacante).val(),
            salario     :$(".editSalario"+id_vacante).val(),
        }

        _this.model.f_editarVacante(la_data).done(function(response){
            if(response.ok){
                location.href = BASE_URL+'catalogo-general/ver-vacantes';
            }else{
                swal("Ups!","No se realizaron los cambios,favor de verificar","error");
            }
        });
        
    },
    f_elegirCuestionarios:function(){
        var _this = this;

        id_cliente = $(".txtCliente").val();
        if(id_cliente != 0){
            _this.model.f_getCuestionarios(id_cliente).done(function(response){
                html="";
                response.cuestionarios.forEach(item=>{
                    html+="<div class='col-md-4'>";
                    html+="<input type='checkbox' value='"+item.id_cuestionario+"'> ";
                    html+= item.titulo_cuestionario;
                    html+="</div>";
                });
                $("#tipo_cuestionarios").html(html);
            });
        }
    },
    f_cuestionariosAsigna:function(e){
        var _this = this;
        lo_current = e.currentTarget;

        var id_vacante = parseInt($(lo_current).data('hash'));

        $("#tipo_cuestionarios").find("input[type=checkbox]").each(function(idx, ele){
            var checkbox = $(this);
            if(checkbox.is(":checked")){
                valor   = checkbox[0].value;

                la_data = {
                    id_vacante:id_vacante,
                    id_cuestionario:valor
                }

                _this.model.f_asignatCuestionarios(la_data).done(function(response){
                    if(response.ok){
                        swal("Bien!","Cuestionarios asiganados correctamente","success");
                        location.href = BASE_URL+'catalogo-general/ver-vacantes';
                    }
                });
            }
        });
    }

});

$(document).ready(function () {
    catalogo_view = new catalogo_view({model: new catalogo_model()});
    
});